import{d as e,cm as o,m as n,E as i,F as a,a as t,o as r,c as l,f as s,w as c,i as d,v as g}from"./vendor.a2f65e0a.js";const u=e({name:"SurveillanceVideo",setup:()=>({refresh:o("reload"),g_iWndIndex:0,g_bPTZAuto:!1,pumpRoomName:"",cameraArray:[],iWidth:1200,iHeight:800,iProtocol:1,iStreamType:1,bZeroChannel:!1,szDeviceIdentify:""}),created:function(){},mounted:function(){n.get("IPconfig/ip.json").then((e=>{if(console.log(e),e.data.hikConfig.length>0){console.log(1111),this.cameraArray=e.data.hikConfig,console.log(this.cameraArray,e.data.hikConfig);for(var o=0;o<this.cameraArray.length;o++){let e=WebVideoCtrl.I_Logout(this.cameraArray[o].ip+"_"+this.cameraArray[o].port);console.log("logoutState====",e),0===e&&location.reload()}this.videoInitPlugin()}}))},destroyed:function(){for(var e=0;e<this.cameraArray.length;e++){WebVideoCtrl.I_Stop({iWndIndex:e}),0!==WebVideoCtrl.I_Logout(this.cameraArray[e].ip)?console.log("WebVideoCtrl I_Logout failed"):console.log("WebVideoCtrl I_Logout success")}},methods:{clickFullScreen:function(){WebVideoCtrl.I_FullScreen(!0)},changeWndNum:function(e){console.log(e);e=parseInt(e,10);WebVideoCtrl.I_ChangeWndNum(e)},downLoadPlugin:function(){confirm("是否下载该插件?")&&(window.location.href={}.BASE_API+"/dashboard/downloadPlug")},videoInitPlugin:function(){if(-1===WebVideoCtrl.I_CheckPluginInstall())return alert("您还未安装过插件，双击开发包目录里的WebComponentsKit.exe安装！"),void this.downLoadPlugin();this.initPlugin()},initPlugin:function(){var e=this;WebVideoCtrl.I_InitPlugin(this.iWidth,this.iHeight,{bWndFull:!0,iWndowType:2,cbSelWnd:function(o){var n=parseInt($(o).find("SelectWnd").eq(0).text(),10),i="当前选择的窗口编号："+n;e.g_iWndIndex=n,console.log(e.g_iWndIndex,i)},async cbInitPluginComplete(){if(WebVideoCtrl.I_InsertOBJECTPlugin("divPlugin"),-1!==WebVideoCtrl.I_CheckPluginVersion()){console.log("cameraArray length:",e.cameraArray);for(var o=0;o<e.cameraArray.length;o++){var n=e.cameraArray[o].ip,i=e.cameraArray[o].port,a=e.cameraArray[o].username,t=e.cameraArray[o].password,r=e.cameraArray[o].channelId,l=e.cameraArray[o].iStreamType;console.log("========",o,n,i,a,t);let c=await e.loginVideo(n,i,a,t);if(console.log("1=1=1==1=1==",c),c){var s=n+"_"+i;let a=await e.startRealPlay(s,o,r,l);console.log("2=2=2==2=1==",a)}console.log("myi=-==",o)}}else alert("检测到新的插件版本，双击开发包目录里的WebComponentsKit.exe升级！")}})},loginVideo(e,o,n,i){var a=this;return new Promise((t=>{WebVideoCtrl.I_Login(e,a.iProtocol,o,n,i,{async:!1,success:function(e){console.log(e),t(!0)},error:function(){let o=e+" 登录失败";window.$message.warning(o),t(!0),console.log("login error")}})}))},startRealPlay:function(e,o,n,i){return console.log("startRealPlay: ",e,o,n),new Promise((a=>{WebVideoCtrl.I_StartRealPlay(e,{iWndIndex:o,iStreamType:i,iChannelID:n,bZeroChannel:!1,success:function(){a({res:!0,ip:e}),console.log("开始预览成功 ")},error:function(o,n){console.log(n),403===o?console.log("szInfo 设备不支持Websocket取流！"):console.log("开始预览失败 "),a({res:!0,ip:e})}})}))},clickCapturePic(){console.log(this.g_iWndIndex);var e=WebVideoCtrl.I_GetWindowStatus(this.g_iWndIndex),o="";if(null!=e){var n=WebVideoCtrl.I_GetLocalCfg(),i="0";null!=n&&(i=$(n).find("CaptureFileFormat").eq(0).text()),console.log("on====",e);var a=e.szDeviceIdentify+"_1_"+(new Date).getTime();a+="0"===i?".jpg":".bmp",WebVideoCtrl.I2_CapturePic(a,{bDateDir:!0}).then((function(){o="抓图成功！";let n=e.szDeviceIdentify+" "+o;window.$message.warning(n)}),(function(){o="抓图失败！";let n=e.szDeviceIdentify+" "+o;window.$message.warning(n)}))}}}});i("data-v-d2b309b0");const m={class:"warning-page"},f=d("h1",{style:{"margin-top":"0","margin-bottom":"30px"}},"智慧油田监控画面",-1),h=g("全屏显示"),I=g("抓拍图像"),p=d("div",{id:"divPlugin",class:"plugin"},null,-1);a(),u.render=function(e,o,n,i,a,d){const g=t("n-button");return r(),l("div",m,[f,s(g,{class:"video-btn",type:"primary",size:"large",onClick:e.clickFullScreen},{default:c((()=>[h])),_:1},8,["onClick"]),s(g,{class:"video-btn",type:"primary",size:"large",onClick:e.clickCapturePic},{default:c((()=>[I])),_:1},8,["onClick"]),p])},u.__scopeId="data-v-d2b309b0";export{u as default};
