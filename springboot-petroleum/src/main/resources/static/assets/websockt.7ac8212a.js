const e="function"==typeof btoa,t="function"==typeof Buffer,n=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),r=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),o=((e=>{let t={};r.forEach(((e,n)=>t[e]=n))})(),String.fromCharCode.bind(String)),c=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),a=e=>{let t,n,o,c,a="";const i=e.length%3;for(let l=0;l<e.length;){if((n=e.charCodeAt(l++))>255||(o=e.charCodeAt(l++))>255||(c=e.charCodeAt(l++))>255)throw new TypeError("invalid character found");t=n<<16|o<<8|c,a+=r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}return i?a.slice(0,i-3)+"===".substring(i):a},i=e?e=>btoa(e):t?e=>Buffer.from(e,"binary").toString("base64"):a,l=t?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let n=0,r=e.length;n<r;n+=4096)t.push(o.apply(null,e.subarray(n,n+4096)));return i(t.join(""))},s=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?o(192|t>>>6)+o(128|63&t):o(224|t>>>12&15)+o(128|t>>>6&63)+o(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return o(240|t>>>18&7)+o(128|t>>>12&63)+o(128|t>>>6&63)+o(128|63&t)},u=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,f=e=>e.replace(u,s),b=t?e=>Buffer.from(e,"utf8").toString("base64"):n?e=>l(n.encode(e)):e=>i(f(e)),_=(e,t=!1)=>t?c(b(e)):b(e),d=_,h={websocket:null,connectURL:`ws://${window.ip}:8080/test/oneToOne`,socket_open:!1,hearbeat_timer:null,hearbeat_interval:45e3,is_reonnect:!0,reconnect_count:3,reconnect_current:1,ronnect_number:0,reconnect_timer:null,reconnect_interval:5e3,init:e=>{if(!("WebSocket"in window))return null;h.websocket=new WebSocket(h.connectURL),h.websocket.onmessage=t=>{e&&e(t)},h.websocket.onclose=e=>{clearInterval(h.hearbeat_interval),h.socket_open=!1,h.is_reonnect&&(h.reconnect_timer=setTimeout((()=>{if(h.reconnect_current>h.reconnect_count)return clearTimeout(h.reconnect_timer),void(h.is_reonnect=!1);h.reconnect_current++,h.reconnect()}),h.reconnect_interval))},h.websocket.onopen=function(){h.socket_open=!0,h.is_reonnect=!0},h.websocket.onerror=function(){}},send:(e,t=null)=>{h.websocket.readyState===h.websocket.OPEN?(h.websocket.send(JSON.stringify(e)),t&&t()):(clearInterval(h.hearbeat_timer),h.ronnect_number++)},receive:e=>e,heartbeat:()=>{h.hearbeat_timer&&clearInterval(h.hearbeat_timer),h.hearbeat_timer=setInterval((()=>{var e={encryption_type:"base64",data:d(JSON.stringify({content:"ping"}))};h.send(e)}),h.hearbeat_interval)},close:()=>{clearInterval(h.hearbeat_interval),h.is_reonnect=!1,h.websocket.close()},reconnect:()=>{h.websocket&&!h.is_reonnect&&h.close(),h.init(null)}};var p=h;export{p as s};
