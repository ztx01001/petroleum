var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,l,n)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,s=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&i(e,l,t[l]);if(n)for(var l of n(t))o.call(t,l)&&i(e,l,t[l]);return e},r=("undefined"!=typeof require&&require,(e,t,l)=>(i(e,"symbol"!=typeof t?t+"":t,l),l));import{d as u,u as d,o as v,c,i as p,f as g,w as f,s as m,N as h,t as _,v as y,b,x,y as w,A as C,B as I,C as P,D as k,E as D,F as S,G as W,H as X,I as Y,J as z,K as L,L as O,M as U,O as V,P as j,Q as T,S as R,T as F,V as $,g as A,W as N,X as J,p as K,Y as M,Z as B,_ as G,r as q,$ as E,a0 as H,a1 as Z,m as Q,a2 as ee,a3 as te,a4 as le,a as ne}from"./vendor.a2f65e0a.js";import{i as ae,a as oe,b as ie,c as se,d as re,e as ue,f as de}from"./install.50cc89d0.js";import{s as ve}from"./websockt.7ac8212a.js";const ce={style:{padding:"10px",display:"flex"}},pe=p("img",{title:"基于vue3+ts+svg的web组件编辑器",class:"logoimg",src:"./assets/logo.03d6d6da.png"},null,-1),ge=p("span",{class:"logotext"},"vue-webtopo-svgeditor",-1),fe={style:{display:"flex",width:"100%","flex-direction":"row-reverse"}},me={href:"https://www.cnblogs.com/Hero-/p/14784744.html",target:"_blank",class:"a-link"},he=y("帮助"),_e={href:"https://github.com/yaolunmao/vue-webtopo-svgeditor",target:"_blank",class:"a-link"},ye=y("Github"),be=y("v3.0"),xe=p("div",null,"这个点了没什么用 不过会变色",-1),we=p("div",null,"说实话 这个版本号就是瞎写的 一点都不严谨",-1),Ce=y("保存");var Ie=u({emits:["saveSvgInfo"],setup(e,{expose:t,emit:l}){const n=d();return t({saveSvgInfoRes(e){0==(null==e?void 0:e.code)?n.error(null==e?void 0:e.msg):1==(null==e?void 0:e.code)?n.success(null==e?void 0:e.msg):2==(null==e?void 0:e.code)&&n.warning(null==e?void 0:e.msg)}}),(e,t)=>(v(),c("div",ce,[pe,ge,p("div",fe,[p("a",me,[g(m(h),{text:""},{default:f((()=>[he])),_:1})]),p("a",_e,[g(m(h),{text:""},{default:f((()=>[ye])),_:1})]),g(m(_),{trigger:"hover"},{trigger:f((()=>[g(m(h),{text:"",class:"button-class"},{default:f((()=>[be])),_:1})])),default:f((()=>[xe,we])),_:1}),g(m(h),{type:"primary",class:"button-class",onClick:t[0]||(t[0]=()=>{l("saveSvgInfo")})},{default:f((()=>[Ce])),_:1})])]))}});const Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},ke=g("g",{fill:"none"},[g("path",{d:"M11.354 15.853a.5.5 0 0 1-.707.001l-5.484-5.465a.55.55 0 0 1 0-.78l5.484-5.464a.5.5 0 0 1 .706.708L6.19 10l5.164 5.147a.5.5 0 0 1 .001.707zm4 0a.5.5 0 0 1-.708.001l-5.484-5.465a.55.55 0 0 1 0-.78l5.484-5.464a.5.5 0 1 1 .706.708L10.187 10l5.165 5.147a.5.5 0 0 1 .001.707z",fill:"currentColor"})],-1);var De=u({name:"ChevronDoubleLeft20Regular",render:function(e,t){return v(),b("svg",Pe,[ke])}});const Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},We=g("g",{fill:"none"},[g("path",{d:"M8.646 4.147a.5.5 0 0 1 .707-.001l5.484 5.465a.55.55 0 0 1 0 .779l-5.484 5.465a.5.5 0 0 1-.706-.708L13.812 10L8.647 4.854a.5.5 0 0 1-.001-.707zm-4 0a.5.5 0 0 1 .707-.001l5.484 5.465a.55.55 0 0 1 0 .779l-5.484 5.465a.5.5 0 0 1-.706-.708L9.812 10L4.647 4.854a.5.5 0 0 1-.001-.707z",fill:"currentColor"})],-1);var Xe=u({name:"ChevronDoubleRight20Regular",render:function(e,t){return v(),b("svg",Se,[We])}});D("data-v-00eb8dea");const Ye={class:"svgimg"},ze={class:"leftImgUl"},Le=["title","src","onDragstart","onDragend"],Oe={class:"leftImgUl"},Ue=["title","src","onClick"],Ve={class:"leftImgUl"},je=["title","src","onDragstart","onDragend"],Te={class:"handlehidden"};S();var Re=u({props:{left_imglists:{type:Object,default:[]},select_toolbar:{type:String,default:""}},emits:["setCreatSvgInfo"],setup(e,{emit:t}){const l=e,n=d(),a=x({navclass:"leftnavDisplay",navopen:!0}),o=()=>{a.navopen=!a.navopen,a.navclass="leftnavDisplay"==a.navclass?"leftnavNone":"leftnavDisplay"},i=(e,l)=>{t("setCreatSvgInfo",e)},s=(e,l)=>{var a;if("copy"!==(null==(a=l.dataTransfer)?void 0:a.dropEffect))return n.error("请将组件拖到画布中!"),void t("setCreatSvgInfo",{})};return(e,n)=>(v(),c("div",{class:k(m(a).navclass)},[w(p("div",Ye,[g(m(I),{"default-expanded-names":"1",accordion:""},{default:f((()=>[g(m(W),{title:"常规组件",name:"1",style:{"margin-top":"15px"}},{default:f((()=>[p("ul",ze,[(v(!0),c(X,null,Y(l.left_imglists.commonComponentList,(e=>(v(),c("li",null,[p("img",{title:e.title,src:e.priview_img,draggable:"true",onDragstart:t=>i(e),onDragend:e=>s(0,e)},null,40,Le)])))),256))])])),_:1}),g(m(W),{title:"绘制组件",name:"2"},{default:f((()=>[p("ul",Oe,[(v(!0),c(X,null,Y(l.left_imglists.drawComponentList,(e=>(v(),c("li",null,[p("img",{class:k(l.select_toolbar==e.type?"svg-selected":""),title:e.title,src:e.priview_img,onClick:()=>{t("setCreatSvgInfo",e)}},null,10,Ue)])))),256))])])),_:1}),g(m(W),{title:"图表组件",name:"3"},{default:f((()=>[p("ul",Ve,[(v(!0),c(X,null,Y(l.left_imglists.chartComponentList,(e=>(v(),c("li",null,[p("img",{title:e.title,src:e.priview_img,draggable:"true",onDragstart:t=>i(e),onDragend:e=>s(0,e)},null,40,je)])))),256))])])),_:1})])),_:1})],512),[[C,m(a).navopen]]),p("div",Te,[g(m(P),{class:"handleicon",size:"10",onClick:o},{default:f((()=>[m(a).navopen?(v(),b(m(De),{key:0})):(v(),b(m(Xe),{key:1}))])),_:1})])],2))}});Re.__scopeId="data-v-00eb8dea",D("data-v-5a9686b9");const Fe={class:"rightnav"},$e={style:{"margin-left":"2rem","margin-top":"1rem"}};S();var Ae=u({props:{set_svg_info:{type:Object,default:{}}},setup(e){const t=e;return(e,l)=>(v(),c("div",Fe,[p("div",$e,[g(m(z),{size:"small","label-placement":"left"},{default:f((()=>[g(m(L),{label:"标识"},{default:f((()=>[p("span",null,O(t.set_svg_info.id),1)])),_:1}),g(m(L),{label:"类型"},{default:f((()=>[p("span",null,O(t.set_svg_info.type),1)])),_:1}),g(m(L),{label:"名称"},{default:f((()=>[g(m(U),{placeholder:"请输入名称",value:t.set_svg_info.title,"onUpdate:value":l[0]||(l[0]=e=>t.set_svg_info.title=e)},null,8,["value"])])),_:1}),g(m(L),{label:"x轴坐标"},{default:f((()=>[g(m(V),{value:t.set_svg_info.svgPositionX,"onUpdate:value":l[1]||(l[1]=e=>t.set_svg_info.svgPositionX=e),min:0},null,8,["value"])])),_:1}),g(m(L),{label:"y轴坐标"},{default:f((()=>[g(m(V),{value:t.set_svg_info.svgPositionY,"onUpdate:value":l[2]||(l[2]=e=>t.set_svg_info.svgPositionY=e),min:0},null,8,["value"])])),_:1}),g(m(L),{label:"大小"},{default:f((()=>[g(m(V),{value:t.set_svg_info.size,"onUpdate:value":l[3]||(l[3]=e=>t.set_svg_info.size=e),min:1,step:.1},null,8,["value","step"])])),_:1}),g(m(L),{label:"旋转"},{default:f((()=>[g(m(V),{value:t.set_svg_info.angle,"onUpdate:value":l[4]||(l[4]=e=>t.set_svg_info.angle=e)},null,8,["value"])])),_:1}),(v(!0),c(X,null,Y(t.set_svg_info.extend_attr,(e=>(v(),b(m(L),{label:e.title},{default:f((()=>["numberinputbox"==e.type?(v(),b(m(V),{key:0,value:e.val,"onUpdate:value":t=>e.val=t},null,8,["value","onUpdate:value"])):"colorinputbox"==e.type?(v(),b(m(j),{key:1,modes:["hex"],value:e.val,"onUpdate:value":t=>e.val=t},null,8,["value","onUpdate:value"])):"textinputbox"==e.type?(v(),b(m(U),{key:2,placeholder:`请输入${e.title}`,value:e.val,"onUpdate:value":t=>e.val=t},null,8,["placeholder","value","onUpdate:value"])):"textareainputbox"==e.type?(v(),b(m(U),{key:3,placeholder:`请输入${e.title}`,type:"textarea",value:e.val,"onUpdate:value":t=>e.val=t},null,8,["placeholder","value","onUpdate:value"])):"radiogroup"==e.type?(v(),b(m(T),{key:4,value:e.val.selectval,"onUpdate:value":t=>e.val.selectval=t},{default:f((()=>[g(m(R),null,{default:f((()=>[(v(!0),c(X,null,Y(e.val.ridiogroup,(e=>(v(),b(m(F),{key:e.value,value:e.value},{default:f((()=>[y(O(e.label),1)])),_:2},1032,["value"])))),128))])),_:2},1024)])),_:2},1032,["value","onUpdate:value"])):"select"==e.type?(v(),b(m($),{key:5,value:e.val.selectval,"onUpdate:value":t=>e.val.selectval=t,options:e.val.selectgroup},null,8,["value","onUpdate:value","options"])):A("",!0)])),_:2},1032,["label"])))),256))])),_:1})])]))}});Ae.__scopeId="data-v-5a9686b9";const Ne=p("ul",null,[p("li",null,"常规组件和图表组件用鼠标左键选中并按住可拖动至画布"),p("li",null,"绘制组件需先选中 再将鼠标移至画布中按住左键开始绘制 松开左键结束绘制"),p("li",null,"在画布上单击左键并按住可以拖动组件改变位置"),p("li",null,"当组件选中时会有选中效果 此时右侧面板弹出 可使用快捷键和编辑右侧面板属性更改组件"),p("li",null,"鼠标右键点击组件可以进行一些快捷操作"),p("li",null,"键盘↑↓←→可移动选中组件 ctrl+c复制当前选中组件 deleted删除当前选中组件"),p("li",null,"ctrl+键盘↑↓←→可移动组件图层"),p("li",null,"点击画布空白处可以取消选中组件 并关闭属性面板"),p("li",null,"点击《 符号可以显示或隐藏左侧面板"),p("li",null,"如果使用我的在线体验地址 请先保存绘制再切换到预览界面"),p("li",null,[y("更多使用帮助请参考"),p("a",{href:"https://github.com/yaolunmao/vue-webtopo-svgeditor"},"github"),y("或"),p("a",{href:"https://gitee.com/yaolunmao/vue-webtopo-svgeditor"},"gitee")])],-1);var Je=u({setup:e=>(e,t)=>(v(),b(m(N),{title:"操作说明",embedded:"",bordered:!1},{default:f((()=>[Ne])),_:1}))}),Ke=u({props:{component_type:{type:String,default:""},component_template:{type:String,default:""},component_props:{type:Array,default:""},component_attr:{type:Object,default:{}}},setup(e){const t=e;J([ae,oe,ie,se,re,ue,de]),K(M,"default");const l=B({template:t.component_template,props:["prop_data"]});return(e,n)=>(v(),b(G(m(l)),{prop_data:t.component_attr},null,8,["prop_data"]))}});function Me(e,n){var a,o;e.push((a=s({},JSON.parse(JSON.stringify(e[n.index]))),o={id:`${(new Date).getTime()}`,svgPositionX:e[n.index].svgPositionX+10,svgPositionY:e[n.index].svgPositionY+10,title:e[n.index].title+"-copy"},t(a,l(o))))}function Be(e,t){e.splice(t.index,1)}function Ge(e,t){const l=e[t.index];e.splice(t.index,1),e.push(l),t.index=e.length-1}function qe(e,t){const l=e[t.index];e.splice(t.index,1),e.unshift(l),t.index=0}function Ee(e,t){if(1===e.length||t.index===e.length-1)return;const l=e[t.index];e[t.index]=e[t.index+1],e[t.index+1]=l,t.index+=1}function He(e,t){if(1===e.length||0===t.index)return;const l=e[t.index];e[t.index]=e[t.index-1],e[t.index-1]=l,t.index-=1}D("data-v-4e7ab327");const Ze={class:"navtop"},Qe={class:"navleft"},et=["width","height","viewBox"],tt=p("defs",null,null,-1),lt=p("filter",{x:"0",y:"0",width:"1",height:"1",id:"solid"},[p("feFlood",{"flood-color":"rgb(255,255,255)"}),p("feComposite",{in:"SourceGraphic"})],-1),nt=["id","transform","onMousedown","onContextmenu"],at={class:"navright"},ot={class:"navbuttom"},it=["onClick"],st={class:"shortcut"};S();var rt=u({props:{component_infos:{type:Array,required:!0,default:[]},svgCanvas:{type:Object,default:{width:1520,height:720}}},emits:["saveSvgInfo"],setup(e,{expose:t,emit:l}){const n=e,a=q(null),o=q(),i=x([]),r=q(null),u=q(!1),d=x([{name:"复制",hotkey:"Ctrl+C",enable:!0,fun:function(){this.enable&&(Me(i,_),u.value=!1)}},{name:"删除",hotkey:"Delete",enable:!1,fun:function(){this.enable&&(Be(i,_),u.value=!1)}},{name:"置于顶层",hotkey:"Ctrl+→",enable:!0,fun:function(){this.enable&&(Ge(i,_),u.value=!1)}},{name:"置于底层",hotkey:"Ctrl+←",enable:!0,fun:function(){this.enable&&(qe(i,_),u.value=!1)}},{name:"置于上一层",hotkey:"Ctrl+↑",enable:!0,fun:function(){this.enable&&(Ee(i,_),u.value=!1)}},{name:"置于下一层",hotkey:"Ctrl+↓",enable:!0,fun:function(){this.enable&&(He(i,_),u.value=!1)}}]),h=q({id:"",title:"",svgPositionX:0,svgPositionY:0}),_=x({id:"",index:0,sPositionX:0,sPositionY:0,create_type:""}),b=q({}),I=q({commonComponentList:[],drawComponentList:[],chartComponentList:[]}),P=q(""),D=x({status:0,mPositionX:0,mPositionY:0}),S=q(!1),W=e=>{if(Object.keys(b.value).length<1)return;const t={id:`${(new Date).getTime()}`,type:b.value.type,title:b.value.title,svgPositionX:e.offsetX,svgPositionY:e.offsetY,angle:0,size:1,extend_attr:JSON.parse(JSON.stringify(b.value.extend_attr))};i.push(t),b.value={}},z=e=>{S.value=!1,e.preventDefault()},L=e=>{e.preventDefault()},U=e=>{b.value=e,P.value=e.type},V=()=>{0!=i.length?(r.value.saveSvgInfoRes(i.length>0?{code:1,msg:"保存成功!"}:{code:0,msg:"保存失败!"}),l("saveSvgInfo",i,a.value)):r.value.saveSvgInfoRes({code:2,msg:"请先绘制图像!"})},j=e=>{var t,l,n,a,o,r,u,d;if(1!=D.status||!_.id)return;const{clientX:v,clientY:c}=e;if("draggable"==_.create_type){let e=s({},_);e.sPositionX+=v-D.mPositionX,e.sPositionY+=c-D.mPositionY,({sPositionX:i[_.index].svgPositionX,sPositionY:i[_.index].svgPositionY}=e)}else"draw"==_.create_type&&(null!=(null==(l=null==(t=i[_.index].extend_attr)?void 0:t.startpoint_x)?void 0:l.val)&&(i[_.index].extend_attr.startpoint_x.val=0),null!=(null==(a=null==(n=i[_.index].extend_attr)?void 0:n.startpoint_y)?void 0:a.val)&&(i[_.index].extend_attr.startpoint_y.val=0),null!=(null==(r=null==(o=i[_.index].extend_attr)?void 0:o.endpoint_x)?void 0:r.val)&&(i[_.index].extend_attr.endpoint_x.val=v-D.mPositionX),null!=(null==(d=null==(u=i[_.index].extend_attr)?void 0:u.endpoint_y)?void 0:d.val)&&(i[_.index].extend_attr.endpoint_y.val=c-D.mPositionY))},T=e=>{1==D.status&&_.id&&(D.status=0,S.value=!0,h.value=i[_.index],b.value={},P.value="")},R=e=>{if(Object.keys(b.value).length<1)return S.value=!1,void(_.id="");const t={id:`${(new Date).getTime()}`,type:b.value.type,title:b.value.title,svgPositionX:e.offsetX,svgPositionY:e.offsetY,angle:0,size:1,extend_attr:JSON.parse(JSON.stringify(b.value.extend_attr))};i.push(t),({id:_.id,svgPositionX:_.sPositionX,svgPositionY:_.sPositionY}=t),S.value=!1,_.index=i.length-1,_.create_type="draw",D.status=1,D.mPositionX=e.clientX,D.mPositionY=e.clientY},F=e=>{e.preventDefault(),u.value=!0,o.value.style.left=e.pageX+"px",o.value.style.top=e.pageY+"px",d.map((e=>e.enable=!0)),1===i.length?(d[3].enable=!1,d[5].enable=!1,d[2].enable=!1,d[4].enable=!1):0===_.index?(d[3].enable=!1,d[5].enable=!1):_.index===i.length-1&&(d[2].enable=!1,d[4].enable=!1)},$=e=>{2!==e.button&&(u.value=!1)};E((()=>[...n.component_infos]),((e,t)=>{I.value={commonComponentList:e.filter((e=>"common"==e.panel_class)),drawComponentList:e.filter((e=>"draw"==e.panel_class)),chartComponentList:e.filter((e=>"chart"==e.panel_class))}})),document.onkeydown=function(e){_.id&&(e.ctrlKey||"ArrowUp"!=e.key?e.ctrlKey||"ArrowDown"!=e.key?e.ctrlKey||"ArrowLeft"!=e.key?e.ctrlKey||"ArrowRight"!=e.key?e.ctrlKey&&"c"==e.key.toLowerCase()?(e.preventDefault(),Me(i,_)):"Delete"==e.key?(e.preventDefault(),Be(i,_),S.value=!1):e.ctrlKey&&"ArrowUp"==e.key?(e.preventDefault(),Ee(i,_)):e.ctrlKey&&"ArrowDown"==e.key?(e.preventDefault(),He(i,_)):e.ctrlKey&&"ArrowLeft"==e.key?(e.preventDefault(),qe(i,_)):e.ctrlKey&&"ArrowRight"==e.key&&(e.preventDefault(),Ge(i,_)):(e.preventDefault(),function(e,t){e[t.index].svgPositionX+=1}(i,_)):(e.preventDefault(),function(e,t){e[t.index].svgPositionX-=1}(i,_)):(e.preventDefault(),function(e,t){e[t.index].svgPositionY+=1}(i,_)):(e.preventDefault(),function(e,t){e[t.index].svgPositionY-=1}(i,_)))};return t({setSvgLists:e=>{i.length=0,i.push(...e),l("saveSvgInfo",i,a.value)}}),(t,l)=>(v(),c(X,null,[p("div",Ze,[g(m(H),null,{default:f((()=>[g(Ie,{onSaveSvgInfo:V,ref:(e,t)=>{t.topbar_dom_ref=e,r.value=e}},null,512)])),_:1})]),p("div",{class:"ancestors",onMousedown:$},[p("div",Qe,[g(m(H),null,{default:f((()=>[g(Re,{left_imglists:I.value,select_toolbar:P.value,onSetCreatSvgInfo:U},null,8,["left_imglists","select_toolbar"])])),_:1})]),p("div",{class:"warp",onDrop:W,onDragenter:z,onDragover:L,onMousemove:j,onMouseup:T,onMousedown:R},[(v(),c("svg",{xmlns:"http://www.w3.org/2000/svg",style:{"background-color":"#000000"},width:e.svgCanvas.width,height:e.svgCanvas.height,viewBox:`0 0 ${e.svgCanvas.width} ${e.svgCanvas.height}`,ref:(e,t)=>{t.svg_dom_ref=e,a.value=e}},[tt,lt,(v(!0),c(X,null,Y(m(i),((e,t)=>(v(),c("g",{style:{cursor:"pointer"},class:k(e.id==m(_).id?"svg-selected":""),key:e.id,id:e.id,transform:"translate("+e.svgPositionX+","+e.svgPositionY+")rotate("+e.angle+")scale("+e.size+")",onMousedown:l=>((e,t,l)=>{l.preventDefault(),l.cancelBubble=!0,b.value={},({id:_.id,svgPositionX:_.sPositionX,svgPositionY:_.sPositionY}=e),S.value=!1,_.index=t,_.create_type="draggable",D.status=1,D.mPositionX=l.clientX,D.mPositionY=l.clientY})(e,t,l),onContextmenu:Z(F,["stop"])},[g(Ke,{component_type:e.type,component_template:n.component_infos.filter((t=>t.type==e.type))[0].template,component_props:n.component_infos.filter((t=>t.type==e.type))[0].props,component_attr:e},null,8,["component_type","component_template","component_props","component_attr"])],42,nt)))),128))],8,et))],32),w(p("div",at,[g(Ae,{set_svg_info:h.value},null,8,["set_svg_info"])],512),[[C,S.value]])],32),p("div",ot,[g(Je)]),w(p("ul",{ref:(e,t)=>{t.contextMenuRef=e,o.value=e},class:"contextMenu"},[(v(!0),c(X,null,Y(m(d),((e,t)=>(v(),c("li",{key:t,onClick:t=>e.fun()},[p("p",{class:k(e.enable?"":"disabled")},[y(O(e.name)+" ",1),p("span",st,O(e.hotkey),1)],2)],8,it)))),128))],512),[[C,u.value]])],64))}});rt.__scopeId="data-v-4e7ab327";const ut=["viewBox"],dt=["id","transform"];var vt=u({props:{component_infos:{type:Array,required:!0,default:[]},svg_data:{type:Array,required:!0,default:[]},svgCanvas:{type:Object,default:{width:1520,height:720}}},setup(e){const t=e;return(e,l)=>(v(),c("svg",{xmlns:"http://www.w3.org/2000/svg",style:{"background-color":"#000000"},width:"100%",height:"100%",viewBox:`0 0 ${t.svgCanvas.width} ${t.svgCanvas.height}`},[(v(!0),c(X,null,Y(t.svg_data,((e,l)=>(v(),c("g",{key:e.id,id:e.id,transform:"translate("+e.svgPositionX+","+e.svgPositionY+")rotate("+e.angle+")scale("+e.size+")"},[g(Ke,{component_type:e.type,component_template:t.component_infos.filter((t=>t.type==e.type))[0].template,component_props:t.component_infos.filter((t=>t.type==e.type))[0].props,component_attr:e},null,8,["component_type","component_template","component_props","component_attr"])],8,dt)))),128))],8,ut))}});class ct{constructor(){r(this,"g_iWndIndex",0),r(this,"szDeviceIdentify",""),r(this,"deviceport",""),r(this,"channels"),r(this,"ip",""),r(this,"port",""),r(this,"username",""),r(this,"password","")}init(e,t,l,n){this.ip=e,this.port=t,this.username=l,this.password=n;let a=WebVideoCtrl.I_CheckPluginInstall();console.log(a),-1!=a?WebVideoCtrl.I_InitPlugin("100%","100%",{bWndFull:!0,iPackageType:2,iWndowType:1,cbInitPluginComplete(){WebVideoCtrl.I_InsertOBJECTPlugin("divPlugin")}}):alert("您还未安装过插件，双击开发包目录里的WebComponentsKit.exe安装！")}clickLogin(){if(""==this.ip||""==this.port)return;this.szDeviceIdentify=this.ip+"_"+this.port;let e=this;WebVideoCtrl.I_Login(this.ip,1,this.port,this.username,this.password,{success:e=>{setTimeout((()=>{this.getChannelInfo(),this.getDevicePort()}),10),setTimeout((()=>{this.clickStartRealPlay()}),500),console.log("登录成功")},error:function(t,l){let n=e.szDeviceIdentify+"登录失败";window.$message.warning(n),console.log("登录失败",t,l)}})}clickLogout(){if(this.szDeviceIdentify=this.ip+"_"+this.port,null==this.szDeviceIdentify)return;let e=WebVideoCtrl.I_Logout(this.szDeviceIdentify);return console.log(e,this.szDeviceIdentify),0==e&&(this.getChannelInfo(),this.getDevicePort()),e}getChannelInfo(){this.channels=[],null!=this.szDeviceIdentify&&WebVideoCtrl.I_GetAnalogChannelInfo(this.szDeviceIdentify,{async:!1,success:e=>{let t=e.getElementsByTagName("VideoInputChannel");console.log("获取模拟通道成功",e);for(let l=0;l<t.length;l++){let e=t[l].querySelector("id").firstChild.nodeValue,n=t[l].querySelector("name").firstChild.nodeValue;""==n&&(n="Camera "+(l<9?"0"+(l+1):l+1)),this.channels.push({id:e,name:n})}},error:function(e,t){console.log("获取模拟通道失败",e)}})}getDevicePort(){if(null===this.szDeviceIdentify)return;let e=WebVideoCtrl.I_GetDevicePort(this.szDeviceIdentify);null!=e&&(this.deviceport=e.iDevicePort,this.deviceport=e.iRtspPort),console.log("端口:",e)}clickStartRealPlay(){let e=WebVideoCtrl.I_GetWindowStatus(this.g_iWndIndex),t=+this.channels[0].id;if(null==this.szDeviceIdentify)return;const l=()=>{WebVideoCtrl.I_StartRealPlay(this.szDeviceIdentify,{iRtspPort:this.deviceport,iStreamType:2,iChannelID:t,bZeroChannel:!1,success:e=>{console.log("预览成功",e)},error:(e,t)=>{console.log("预览失败",e)}})};null!=e?WebVideoCtrl.I_Stop({success:function(){l()}}):l()}clickStopRealPlay(){null!=WebVideoCtrl.I_GetWindowStatus(this.g_iWndIndex)&&WebVideoCtrl.I_Stop({success:function(){console.log("停止播放成功")},error:function(){console.log("停止播放失败")}})}clickFullScreen(){WebVideoCtrl.I_FullScreen(!0)}clickCapturePic(){var e=WebVideoCtrl.I_GetWindowStatus(this.g_iWndIndex),t="";if(null!=e){var l=WebVideoCtrl.I_GetLocalCfg(),n="0";null!=l&&(n=l.find("CaptureFileFormat").eq(0).text());var a=+this.channels[0].id,o=e.szDeviceIdentify+"_"+a+"_"+(new Date).getTime();o+="0"===n?".jpg":".bmp",WebVideoCtrl.I2_CapturePic(o,{bDateDir:!0}).then((function(){t="抓图成功！";let l=e.szDeviceIdentify+" "+t;window.$message.warning(l)}),(function(){t="抓图失败！";let l=e.szDeviceIdentify+" "+t;window.$message.warning(l)}))}}clickCapturePicData(){var e=WebVideoCtrl.I_GetWindowStatus(this.g_iWndIndex),t="";null!=e&&WebVideoCtrl.I2_CapturePicData().then((function(l){t="抓图上传成功！",console.log(l);let n=e.szDeviceIdentify+" "+t;window.$message.warning(n)}),(function(){t="抓图失败！";let l=e.szDeviceIdentify+" "+t;window.$message.warning(l)}))}}const pt={class:"main-page"},gt={class:"alarm-review-box"},ft=y("查看全部"),mt=y(" 清空列表 "),ht={class:"HKIV-main"},_t=y(" 全屏 "),yt=p("div",{id:"divPlugin",class:"plugin"},null,-1);var bt=u({setup(e){const t=q(null),l=q([]),n=q(),a=q([]);Q.get("InterfaceReturn.json").then((e=>{l.value=e.data}));const o=q(1),i=q([]),s=q(null),r=(e,t)=>{i.value=e,s.value=t},u=q(),d=q([]),m=[{title:"告警",key:"alarmName"},{title:"等级",key:"alarmLevel"},{title:"时间",key:"time"}],h=e=>{Q.get("new1665647267903.json").then((l=>{clearInterval(t.value),a.value=l.data;let n=[...l.data],o=[];if(!e)return;console.log(e),o=e;let i=[];for(let e=0;e<o.length;e++)i.push(o[e].widgetID);const s=i.map((e=>n.filter((t=>(null==t?void 0:t.id)==e))[0]));let r={};for(let e=0;e<o.length;e++)Object.assign(r,{[o[e].widgetID]:{name:o[e].name,value:o[e].value}});s.forEach((e=>{e.extend_attr.text.val=r[e.id].name+" : "+r[e.id].value}));let u=n.filter((e=>"RectangleSvg"==e.type));u.forEach((e=>{if("1658206598525"==e.id){let t=r[1657848969373].value;t>690?(t=710,e.extend_attr.fill_color.val="#FF0000"):e.extend_attr.height.val=t-(195+(t-200)/70*50)-(t-200)/70}else if("1658208019574"==e.id){let t=r[1657848379589].value;t>690?(t=710,e.extend_attr.fill_color.val="#FF0000"):e.extend_attr.height.val=t-(195+(t-200)/70*50)-(t-200)/70}else if("1658207277323"==e.id){let t=r[1657848824012].value;t>690?(t=710,e.extend_attr.fill_color.val="#FF0000"):e.extend_attr.height.val=t-(195+(t-200)/70*50)-(t-200)/70}else if("1658207530979"==e.id){let t=r[1657848626934].value;t>490?(t=510,e.extend_attr.fill_color.val="#FF0000"):t<0&&(t=0),e.extend_attr.height.val=t-t/70*50-(t/70-3)}})),console.log("anyRectangleSvgList===",u);const d=JSON.stringify(n);a.value=JSON.parse(d)}))};let _;ee((()=>{})),te((()=>{ve.init(y),h(u.value),_=new ct,Q.get("IPconfig/ip.json").then((e=>{if(e.data.hikWebTopo){_.init(e.data.hikWebTopo.ip,e.data.hikWebTopo.port,e.data.hikWebTopo.username,e.data.hikWebTopo.password);let t=_.clickLogout();console.log("logoutState====",t),0===t&&location.reload(),_.clickLogin()}}))})),le((()=>{console.log("执行了onUnmounted生命周期"),ve.close(),_.clickStopRealPlay()}));const y=e=>{console.log("收到服务器信息",JSON.parse(e.data));let t=JSON.parse(e.data);"data"==t.messageType?h(t.data):"alarm"==t.messageType&&(d.value.unshift(t),console.log(d.value))},b=()=>{d.value=[]},x=()=>{_.clickFullScreen()};return(e,t)=>{const i=ne("router-link"),s=ne("n-button"),u=ne("n-data-table");return v(),c("div",pt,[w(p("div",null,[g(rt,{ref:(e,t)=>{t.ref_svgedit=e,n.value=e},component_infos:l.value,onSaveSvgInfo:r,svgCanvas:{width:1920,height:1080}},null,8,["component_infos"])],512),[[C,0==o.value]]),w(p("div",null,[p("div",gt,[g(s,{type:"success"},{default:f((()=>[g(i,{style:{color:"white","text-decoration":"none"},to:"/alarm/logs/all"},{default:f((()=>[ft])),_:1})])),_:1}),g(s,{type:"error",onClick:b},{default:f((()=>[mt])),_:1}),g(u,{columns:m,data:d.value,bordered:!0,"max-height":200},null,8,["data"])]),p("div",ht,[g(s,{style:{float:"right"},type:"success",onClick:x},{default:f((()=>[_t])),_:1}),yt]),g(vt,{component_infos:l.value,svg_data:a.value,svgCanvas:{width:1920,height:1080}},null,8,["component_infos","svg_data"])],512),[[C,1==o.value]])])}}});export{bt as default};
