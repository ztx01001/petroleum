import{d as e,cj as a,r as l,x as t,a3 as n,m as o,h as s,N as i,a as r,o as d,c as u,i as c,f as m,w as p,H as g,I as v,b as h,v as w,L as f,y,g as C,A as b}from"./vendor.a2f65e0a.js";import{a as k}from"./api.c7737167.js";import{_}from"./ConfirmModel.vue_vue&type=script&setup=true&lang.21a1a799.js";var D=e({name:"WarningForecast",components:{ConfirmModel:_},setup(){const e=a(),r={0:"已关闭",1:"已开启"},d={},u=[{title:"告警ID",key:"alarmID"},{title:"告警名称",key:"alarmName"},{title:"告警等级",key:"alarmLevel",render:(e,a)=>d[e.alarmLevel]},{title:"创建时间",key:"createTime"},{title:"运行状态",key:"status",render:(e,a)=>r[e.status]},{title:"操作",key:"actions",render:(e,a)=>[s(i,{strong:!0,tertiary:!0,size:"small",class:["actions-button"],onClick:()=>D(e,a,"check")},{default:()=>"查看"}),s(i,{strong:!0,tertiary:!0,size:"small",class:["actions-button"],onClick:()=>m(e.status,e,a)},{default:()=>e.status?"关闭":"启动"}),s(i,{strong:!0,tertiary:!0,size:"small",class:["actions-button"],onClick:()=>D(e,a,"delete")},{default:()=>"删除"}),s(i,{strong:!0,tertiary:!0,size:"small",class:["actions-button"],onClick:()=>D(e,a,"log")},{default:()=>"查看日志"})]}],c=l([]),m=(e,a,l)=>{console.log(e,l),o.put(k.alarmManage,{alarmID:a.alarmID,status:1^e}).then((a=>{console.log(a),a.data.status&&(window.$message.success(a.data.message),c.value[l].status=1^e)}))},p=t({alarmName:null,alarmLevel:null,conditionsCard:[{deviceType:null,deviceID:null,operator:null,thresholdValue:null,relationValue:""}],actionsCard:[{operation:null,actionType:null,actionObject:null,content:null}]}),g=l([]),v=l([]),h=l([]),w=l([]),f=l(!1),y=l(!1),C=l(!1),b=l(),_=()=>{o.get(k.alarmManage).then((e=>{console.log(e.data),100==e.data.status?c.value=e.data.data:window.$message.error(e.data.message)})).catch((e=>{console.log(e)}))},D=(a,l,t)=>{var n;console.log(a,l),b.value=a,"check"==t?(o.get(k.alarmManage+"/",{params:{alarmID:a.alarmID}}).then((e=>{console.log(e),100==e.data.status&&(p.alarmName=e.data.data.alarmName,p.alarmLevel=e.data.data.alarmLevel,p.actionsCard=e.data.data.actionsCard,p.conditionsCard=e.data.data.conditionsCard)})),y.value=!0):"log"==t?(n=a.alarmID,e.push({name:"AlarmLogs",params:{alarmID:n}})):"delete"==t&&(C.value=!0)},I=l(null);return n((()=>{o.get(k.alarmLevel).then((e=>{if(console.log(e.data),100==e.data.status){h.value=e.data.data;for(let a=0;a<e.data.data.length;a++)d[e.data.data[a].label]=e.data.data[a].disName;_(),console.log(d)}else window.$message.error(e.data.message)})).catch((e=>{console.log(e)}))})),{tableData:c,columns:u,pagination:!1,showModal:f,warningForm:p,DevicesTypeOptions:g,DevicesOptions:v,levelOptions:h,modelStatus:C,activeRow:b,getAlarmList:_,alarmLevel:d,alarmStatus:r,alarmInfoShowModal:y,conditionOptions:[{label:">",value:">"},{label:"<",value:"<"}],actionsOptions:[{label:"消息通知",value:"send"}],msgTypeOptions:w,rules:{alarmName:{required:!0,trigger:["blur","input"],message:"请输入 告警名称"},alarmLevel:{required:!0,message:"请选择 告警级别"}},formRef:I,handleValidateButtonClick(e){var a;e.preventDefault(),null==(a=I.value)||a.validate((e=>{var a;e?(console.log(e),window.$message.error("验证失败")):(a=p,o.post(k.alarmManage,a).then((e=>{console.log(e),100==e.data.status?(window.$message.success(e.data.message),f.value=!1,_()):window.$message.success(e.data.message)})),console.log(a),window.$message.success("验证成功"))}))},handleNegativeClick(){window.$message.info("已取消")}}},methods:{selectDeviceTypeGet(e,a){console.log(e,a),this.warningForm.conditionsCard[a].deviceID=null,o.get(k.deviceType+"/"+e).then((e=>{console.log(e),100==e.data.status?this.DevicesOptions[a]=e.data.data:window.$message.error(e.data.message)})).catch((e=>{console.log(e)}))},createWarning(){o.get(k.deviceType).then((e=>{console.log(e.data),100==e.data.status?this.DevicesTypeOptions=e.data.data:window.$message.error(e.data.message)})).catch((e=>{console.log(e)})),o.get(k.actiontype).then((e=>{console.log(e.data),100==e.data.status?this.msgTypeOptions=e.data.data:window.$message.error(e.data.message)})).catch((e=>{console.log(e)})),this.showModal=!0},addConditionsItem(){this.warningForm.conditionsCard.length<=3?(this.warningForm.conditionsCard.push({deviceType:null,deviceID:null,operator:null,thresholdValue:null,relationValue:""}),this.DevicesOptions.push([]),console.log(this.DevicesOptions)):window.$message.warning("最多添加三个条件")},removeConditionsItem(e){this.warningForm.conditionsCard.splice(e,1)},addActionsItem(){this.warningForm.actionsCard.length<3?this.warningForm.actionsCard.push({operation:null,actionType:null,actionObject:null,content:null}):window.$message.warning("最多添加三个条件")},removeActionsItem(e){this.warningForm.actionsCard.splice(e,1)},resetWarning(){this.warningForm.alarmName=null,this.warningForm.conditionsCard=[{deviceType:null,deviceID:null,operator:null,thresholdValue:null,relationValue:""}],this.warningForm.actionsCard=[{operation:null,actionType:null,actionObject:null,content:null}]},closeModel(){this.resetWarning()},handleModelStatus(e){console.log(e),this.modelStatus=e.modelStatus,e.result?o.delete(k.alarmManage,{params:{alarmID:this.activeRow.alarmID}}).then((e=>{console.log(e),100==e.data.status&&(window.$message.success(e.data.message),this.getAlarmList())})):window.$message.info("已取消删除")}}});const I={class:"warning-page"},F=c("h1",{style:{"margin-top":"0","margin-bottom":"30px"}},"智慧油田设备告警规则设置",-1),$=w("设置设备告警规则"),T={style:{display:"flex","justify-content":"space-between"}},x={style:{display:"flex"}},O=w(" 删除 "),U={style:{display:"flex","justify-content":"space-between"}},M=w(" and "),N=w(" or "),L=w("新增条件"),V={style:{display:"flex"}},j={style:{display:"flex","justify-content":"space-between"}},S=w(" 删除 "),q=w("新增动作"),A={style:{display:"flex","justify-content":"space-between"}},z=w("重置"),W=w(" 此操作会将所有设置清空,是否继续? "),R=w("确认新增"),G=c("th",null,"告警等级",-1),H=c("th",null,"告警状态",-1),B=c("th",null,"创建时间 ",-1);D.render=function(e,a,l,t,n,o){const s=r("n-button"),i=r("n-space"),k=r("n-data-table"),_=r("n-divider"),D=r("n-input"),P=r("n-form-item"),E=r("n-radio"),J=r("n-radio-group"),K=r("n-select"),Q=r("n-input-number"),X=r("n-card"),Y=r("n-popconfirm"),Z=r("n-form"),ee=r("n-modal"),ae=r("ConfirmModel"),le=r("n-table");return d(),u(g,null,[c("div",I,[F,m(i,{vertical:"",size:12},{default:p((()=>[m(i,null,{default:p((()=>[m(s,{type:"info",size:"large",onClick:e.createWarning},{default:p((()=>[$])),_:1},8,["onClick"])])),_:1}),m(k,{columns:e.columns,data:e.tableData,pagination:e.pagination,bordered:!1},null,8,["columns","data","pagination"])])),_:1}),m(ee,{show:e.showModal,"onUpdate:show":a[2]||(a[2]=a=>e.showModal=a),preset:"dialog",title:"新增告警",style:{width:"800px"},"on-after-leave":e.closeModel,"mask-closable":!1},{default:p((()=>[m(_),m(Z,{ref:"formRef",model:e.warningForm,rules:e.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",style:{maxWidth:"700px"}},{default:p((()=>[c("div",T,[m(P,{label:"告警名称",path:"alarmName"},{default:p((()=>[m(D,{value:e.warningForm.alarmName,"onUpdate:value":a[0]||(a[0]=a=>e.warningForm.alarmName=a),class:"model-input",placeholder:"请输入告警名称"},null,8,["value"])])),_:1}),m(P,{label:"告警级别",path:"alarmLevel"},{default:p((()=>[m(J,{value:e.warningForm.alarmLevel,"onUpdate:value":a[1]||(a[1]=a=>e.warningForm.alarmLevel=a),name:"levelGroup"},{default:p((()=>[m(i,null,{default:p((()=>[(d(!0),u(g,null,v(e.levelOptions,(e=>(d(),h(E,{key:e.value,value:e.label},{default:p((()=>[w(f(e.disName),1)])),_:2},1032,["value"])))),128))])),_:1})])),_:1},8,["value"])])),_:1})]),(d(!0),u(g,null,v(e.warningForm.conditionsCard,((a,l)=>(d(),h(P,{key:l,style:{width:"700px"},label:`触发条件${l+1}`,path:"conditionCard"},{default:p((()=>[m(X,{"content-style":"width:600px;"},{default:p((()=>[m(P,{path:`conditionsCard[${l}].deviceType`,rule:{required:!0,message:"请选择设备类型",trigger:["blur","change"]}},{default:p((()=>[m(K,{class:"model-input",value:a.deviceType,"onUpdate:value":[e=>a.deviceType=e,a=>{e.selectDeviceTypeGet(a,l)}],placeholder:"请选择设备类型",options:e.DevicesTypeOptions},null,8,["value","onUpdate:value","options"])])),_:2},1032,["path"]),c("div",x,[m(P,{path:`conditionsCard[${l}].deviceID`,rule:{type:"number",required:!0,message:"请选择设备",trigger:["blur","change"]}},{default:p((()=>[m(K,{class:"model-input",value:a.deviceID,"onUpdate:value":e=>a.deviceID=e,placeholder:"请选择设备",options:e.DevicesOptions[l]},null,8,["value","onUpdate:value","options"])])),_:2},1032,["path"]),m(P,{path:`conditionsCard[${l}].operator`,rule:{required:!0,message:"请选择条件",trigger:["blur","change"]}},{default:p((()=>[m(K,{class:"model-input",value:a.operator,"onUpdate:value":e=>a.operator=e,placeholder:"请选择条件",options:e.conditionOptions},null,8,["value","onUpdate:value","options"])])),_:2},1032,["path"]),m(P,{path:`conditionsCard[${l}].thresholdValue`,rule:{type:"number",required:!0,message:`请输入阈值${l+1}`,trigger:["input","blur"]}},{default:p((()=>[m(Q,{value:a.thresholdValue,"onUpdate:value":e=>a.thresholdValue=e,class:"model-input",placeholder:"请输入阈值",clearable:""},null,8,["value","onUpdate:value"])])),_:2},1032,["path","rule"]),y(m(s,{style:{"margin-left":"12px"},onClick:a=>e.removeConditionsItem(l)},{default:p((()=>[O])),_:2},1032,["onClick"]),[[b,l]])]),c("div",U,[l<e.warningForm.conditionsCard.length-1?(d(),h(P,{key:0,style:{display:"flex"},path:`conditionsCard[${l}].relationValue`,rule:{required:!0,trigger:"change",message:"请选择 连接方式"}},{default:p((()=>[m(J,{value:a.relationValue,"onUpdate:value":e=>a.relationValue=e,name:"relationGroup"},{default:p((()=>[m(i,null,{default:p((()=>[m(E,{value:"&&"},{default:p((()=>[M])),_:1}),m(E,{value:"||"},{default:p((()=>[N])),_:1})])),_:1})])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["path"])):C("",!0),y(m(s,{type:"primary",text:"",onClick:e.addConditionsItem},{default:p((()=>[L])),_:2},1032,["onClick"]),[[b,l+1==e.warningForm.conditionsCard.length]])])])),_:2},1024)])),_:2},1032,["label"])))),128)),(d(!0),u(g,null,v(e.warningForm.actionsCard,((a,l)=>(d(),h(P,{key:l,style:{width:"700px"},label:`执行动作${l+1}`,path:"actionsCard"},{default:p((()=>[m(X,{"content-style":"width:600px;"},{default:p((()=>[c("div",V,[m(P,{path:`actionsCard[${l}].operation`,rule:{required:!0,message:"请选择动作",trigger:["blur","change"]}},{default:p((()=>[m(K,{class:"model-input",value:a.operation,"onUpdate:value":e=>a.operation=e,placeholder:"请选择动作",options:e.actionsOptions},null,8,["value","onUpdate:value","options"])])),_:2},1032,["path"]),m(P,{path:`actionsCard[${l}].actionType`,rule:{required:!0,message:"请选择通知类型",trigger:["blur","change"]}},{default:p((()=>[m(K,{class:"model-input",value:a.actionType,"onUpdate:value":e=>a.actionType=e,placeholder:"请选择通知类型",options:e.msgTypeOptions},null,8,["value","onUpdate:value","options"])])),_:2},1032,["path"]),m(P,{path:`actionsCard[${l}].actionObject`,rule:{required:!0,message:"请输入接收对象",trigger:["blur","input"]}},{default:p((()=>[m(D,{value:a.actionObject,"onUpdate:value":e=>a.actionObject=e,class:"model-input",placeholder:"根据类型输入接收对象",clearable:""},null,8,["value","onUpdate:value"])])),_:2},1032,["path"])]),c("div",j,[m(P,{path:`actionsCard[${l}].content`,rule:{required:!0,message:`请输入模板${l+1}`,trigger:["input","blur"]}},{default:p((()=>[m(D,{type:"textarea",value:a.content,"onUpdate:value":e=>a.content=e,class:"model-input",placeholder:"请输入消息内容",clearable:""},null,8,["value","onUpdate:value"])])),_:2},1032,["path","rule"]),y(m(s,{style:{"margin-left":"12px"},onClick:a=>e.removeActionsItem(l)},{default:p((()=>[S])),_:2},1032,["onClick"]),[[b,l]])]),y(m(s,{type:"primary",text:"",onClick:e.addActionsItem},{default:p((()=>[q])),_:2},1032,["onClick"]),[[b,l+1==e.warningForm.actionsCard.length]])])),_:2},1024)])),_:2},1032,["label"])))),128)),c("div",A,[m(Y,{onPositiveClick:e.resetWarning,onNegativeClick:e.handleNegativeClick,"positive-text":"确认","negative-text":"取消"},{trigger:p((()=>[m(s,null,{default:p((()=>[z])),_:1})])),default:p((()=>[W])),_:1},8,["onPositiveClick","onNegativeClick"]),m(s,{type:"primary",onClick:e.handleValidateButtonClick},{default:p((()=>[R])),_:1},8,["onClick"])])])),_:1},8,["model","rules"])])),_:1},8,["show","on-after-leave"])]),m(ae,{modelStatus:e.modelStatus,onHandleModelStatus:e.handleModelStatus},null,8,["modelStatus","onHandleModelStatus"]),m(ee,{show:e.alarmInfoShowModal,"onUpdate:show":a[3]||(a[3]=a=>e.alarmInfoShowModal=a)},{default:p((()=>[m(X,{title:e.warningForm.alarmName,bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:p((()=>[m(le,{bordered:!0,"single-line":!1},{default:p((()=>[c("thead",null,[c("tr",null,[G,H,B,(d(!0),u(g,null,v(e.warningForm.conditionsCard,((e,a)=>(d(),u("th",{key:a}," 触发条件"+f(a+1),1)))),128)),(d(!0),u(g,null,v(e.warningForm.actionsCard,((e,a)=>(d(),u("th",{key:a}," 执行动作"+f(a+1),1)))),128))])]),c("tbody",null,[c("tr",null,[c("td",null,f(e.alarmLevel[e.warningForm.alarmLevel]),1),c("td",null,f(e.alarmStatus[e.activeRow.status]),1),c("td",null,f(e.activeRow.createTime),1),(d(!0),u(g,null,v(e.warningForm.conditionsCard,((e,a)=>(d(),u("td",{key:a},[w(f(e.deviceName)+f(e.operator)+f(e.thresholdValue),1),y(c("span",null,f(e.relationValue),513),[[b,e.relationValue]])])))),128)),(d(!0),u(g,null,v(e.warningForm.actionsCard,((e,a)=>(d(),u("td",{key:a},f(e.actionType)+"："+f(e.actionObject)+" "+f(e.operation)+"："+f(e.content),1)))),128))])])])),_:1})])),_:1},8,["title"])])),_:1},8,["show"])],64)};export{D as default};
