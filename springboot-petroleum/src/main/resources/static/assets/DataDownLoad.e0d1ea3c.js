import{d as a,cm as e,r as t,x as s,a3 as l,m as o,h as n,N as i,E as r,F as d,a as c,o as m,c as u,i as p,f as g,w as k,y as h,A as w,v as f}from"./vendor.a2f65e0a.js";import{f as v}from"./time.5cdf33f2.js";import{a as y}from"./api.c7737167.js";var _=a({name:"DataDownLoad",setup(){const a=e("reload"),r={0:"已关闭",1:"已启动"},d=[{title:"任务ID",key:"taskID"},{title:"任务名",key:"taskName"},{title:"表达式",key:"cron"},{title:"运行状态",key:"isRunning",render:(a,e)=>r[a.isRunning]},{title:"类名",key:"beanName"},{title:"方法",key:"methodName"},{title:"创建时间",key:"creat_time"},{title:"描述",key:"discription"},{title:"操作",key:"actions",render:(a,e)=>[n(i,{strong:!0,tertiary:!0,size:"small",class:["actions-button"],onClick:()=>v(a.isRunning,a,e)},{default:()=>a.isRunning?"关闭":"启动"}),n(i,{strong:!0,tertiary:!0,size:"small",class:["actions-button"],onClick:()=>f(a)},{default:()=>"编辑"})]}],c=t([]),m=t("create"),u=s({taskName:null,cron:null,taskType:null,discription:null}),p=t(),g=t(),k=t(1),h=t(!1),w=t(null),f=(a,e,t)=>{console.log(a),h.value=!0,u.taskName=a.taskName,u.cron=a.cron,u.discription=a.discription,m.value="edit",w.value=a.taskID},v=(a,e,t)=>{console.log(a,e.taskID),o.put(y.taskStatus,{taskID:e.taskID,isRunning:1^a}).then((e=>{console.log(e),e.data.status&&(window.$message.success(e.data.message),c.value[t].isRunning=1^a)}))};return l((()=>{o.get(y.taskManage).then((a=>{console.log(a.data),100==a.data.status?c.value=a.data.data:window.$message.error(a.data.message)})).catch((a=>{console.log(a)}))})),{refresh:a,pageSize:p,pageCounts:g,page:k,tableData:c,taskForm:u,edit_task_id:w,list_opt:m,columns:d,pagination:t(!1),datetimerange:t(null),format:"YYYY-mm-dd HH:MM:SS",startTime:t(null),endTime:t(null),showModal:h,rules:{alarmName:{required:!0,trigger:["blur","input"],message:"请输入 告警名称"},alarmLevel:{required:!0,message:"请选择 告警级别"}},taskTypeOptions:[{label:"数据采集定时任务",value:"dataCollect"},{label:"数据导出定时任务",value:"dataExport"}]}},methods:{handlePageChange(a){console.log(a),this.getLogsList(a,this.pageSize,this.pageName,this.alarmID)},openModel(){this.showModal=!0,this.list_opt="create"},resetTask(){this.taskForm.taskName=null,this.taskForm.discription=null,this.taskForm.taskType=null,this.taskForm.cron=null},closeModel(){this.resetTask()},createTaskInfo(a,e){"create"==a?e.taskName?e.cron?e.taskType?o.post(y.taskManage,{taskName:e.taskName,cron:e.cron,taskType:e.taskType,discription:e.discription}).then((a=>{console.log(a),100===a.data.status&&(window.$message.success("创建成功"),this.showModal=!1,this.refresh())})):window.$message.warning("请选择任务分类"):window.$message.warning("请输入表达式"):window.$message.warning("请输入任务名称"):"edit"==a&&(e.taskName?e.cron?(console.log(this.edit_task_id),o.put(y.taskManage,{taskID:this.edit_task_id,taskName:e.taskName,cron:e.cron,discription:e.discription}).then((a=>{console.log(a),100===a.data.status&&(window.$message.success("修改成功"),this.showModal=!1,this.refresh())}))):window.$message.warning("请输入表达式"):window.$message.warning("请输入任务名称")),console.log(e)},onChangeData(a){console.log(a),this.startTime=v(this.format,a[0]),this.endTime=v(this.format,a[1])},exportCsvData(){this.startTime&&this.endTime?o.get(y.downloadCsv,{params:{fileName:"data",start:this.startTime,end:this.endTime}}).then((a=>{console.log(a),200===a.status&&this.export_excel_file(a.data,"data")})):window.$message.warning("请选择要导出数据的日期")},export_excel_file(a,e){let t=document.getElementById("export-link"),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=window.URL.createObjectURL(s);t.href=l;let o=`${e}.csv`;t.download=o,t.click(),window.URL.revokeObjectURL(l)}}});r("data-v-49d2794e");const b={class:"download-box"},T=p("h1",{style:{"margin-top":"0","margin-bottom":"30px"}},"智慧油田数据采集和导出",-1),N=f("添加定时任务"),C=p("h1",null,"自定义采集数据",-1),x={class:"customData"},D=f("导出"),F={id:"export-link"},M=p("div",null,[f("Cron表达式生成器参考地址: "),p("a",{target:"_blank",href:"http://cron.qqe2.com",class:"link-a"},"http://cron.qqe2.com")],-1),U=f(" 保存 ");d(),_.render=function(a,e,t,s,l,o){const n=c("n-button"),i=c("n-data-table"),r=c("n-pagination"),d=c("n-date-picker"),f=c("n-input"),v=c("n-form-item"),y=c("n-select"),_=c("n-form"),I=c("n-modal");return m(),u("div",b,[T,p("div",null,[g(n,{onClick:a.openModel,type:"primary",size:"large",style:{float:"left"}},{default:k((()=>[N])),_:1},8,["onClick"]),g(i,{columns:a.columns,data:a.tableData,bordered:!1},null,8,["columns","data"]),g(r,{page:a.page,"onUpdate:page":[e[0]||(e[0]=e=>a.page=e),a.handlePageChange],"page-count":a.pageCounts},null,8,["page","page-count","onUpdate:page"])]),C,p("div",x,[g(d,{value:a.datetimerange,"onUpdate:value":[e[1]||(e[1]=e=>a.datetimerange=e),a.onChangeData],type:"datetimerange"},null,8,["value","onUpdate:value"]),g(n,{onClick:a.exportCsvData},{default:k((()=>[D])),_:1},8,["onClick"]),h(p("a",F,null,512),[[w,0]]),g(I,{show:a.showModal,"onUpdate:show":e[7]||(e[7]=e=>a.showModal=e),preset:"dialog",title:"新增定时任务",style:{width:"600px"},"on-after-leave":a.closeModel,"mask-closable":!1},{default:k((()=>[g(_,{ref:"formRef",model:a.taskForm,rules:a.rules,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",style:{maxWidth:"500px"}},{default:k((()=>[g(v,{label:"任务名称",path:"taskName"},{default:k((()=>[g(f,{value:a.taskForm.taskName,"onUpdate:value":e[2]||(e[2]=e=>a.taskForm.taskName=e),class:"model-input",placeholder:"请输入任务名称"},null,8,["value"])])),_:1}),g(v,{label:"表达式",path:"cron"},{default:k((()=>[g(f,{value:a.taskForm.cron,"onUpdate:value":e[3]||(e[3]=e=>a.taskForm.cron=e),class:"model-input",placeholder:"请输入表达式"},null,8,["value"]),M])),_:1}),h(g(v,{label:"任务分类",path:"taskType"},{default:k((()=>[g(y,{class:"model-input",value:a.taskForm.taskType,"onUpdate:value":e[4]||(e[4]=e=>a.taskForm.taskType=e),placeholder:"任务分类",options:a.taskTypeOptions},null,8,["value","options"])])),_:1},512),[[w,"create"==a.list_opt]]),g(v,{label:"任务描述",path:"discription"},{default:k((()=>[g(f,{value:a.taskForm.discription,"onUpdate:value":e[5]||(e[5]=e=>a.taskForm.discription=e),class:"model-input",placeholder:"请输入任务描述"},null,8,["value"])])),_:1})])),_:1},8,["model","rules"]),g(n,{onClick:e[6]||(e[6]=e=>a.createTaskInfo(a.list_opt,a.taskForm))},{default:k((()=>[U])),_:1})])),_:1},8,["show","on-after-leave"])])])},_.__scopeId="data-v-49d2794e";export{_ as default};
